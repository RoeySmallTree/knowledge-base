# CABAL User Prompt: Write (V4.1)

**Step:** Write  
**Role:** Operative

---

## Source Variables

| Variable | Source Path | Description |
|----------|-------------|-------------|
| `session.mission_charter` | `stepContext.session.mission_charter` | Mission statement |
| `session.underlying_objectives` | `stepContext.session.underlying_objectives` | Success criteria |
| `session.current_round` | `stepContext.session.current_round` | Current round |
| `currentMember.*` | `MemberContext` | Current operative identity |
| `members` | `stepContext.members` | All team members |
| `assignedProducts[]` | `ProductContext[]` | Products assigned this round |
| `product.versions[]` | `VersionContext[]` | All versions of product |
| `version.author_id` | `VersionContext.author_id` | Who wrote the version |
| `version.content` | `VersionContext.content` | Version content |
| `version.change_summary` | `VersionContext.change_summary` | What changed |
| `version.reflection_notes` | From Reflect output | Operative's reflection before write |
| `version.directive` | From Plan & Assign | Chair directive for this version |
| `product.collabs[]` | `CollabContext[]` | All collabs on product |
| `collab.created_at` | `CollabContext.created_at` | When collab was posted |
| `product.selected_version_id` | `ProductContext.selected_version_id` | Chair-selected version |
| `product.summary` | `ProductContext.summary` | Product summary if exists |

---

## User Prompt Template

### Your Identity

You are **{{currentMember.name}}** ({{currentMember.id}}) — **{{currentMember.team_role}}**.

#### Your Persona
{{currentMember.custom_persona_prompt}}

---

### Mission Context

**Charter:** {{session.mission_charter}}

**Underlying Objectives:**
{{session.underlying_objectives}}

---

### Team Context

{{#each members}}
{{#unless (eq this.id currentMember.id)}}
- **{{this.name}}** ({{this.team_role}}): {{this.operative_responsibility}}
{{/unless}}
{{/each}}

---

### Your Assignment(s)

**Round:** {{session.current_round}}

{{#each assignedProducts}}

---

## Product: {{this.name}} — {{this.type}}

| Field | Value |
|-------|-------|
| **ID** | `{{this.id}}` |
| **Type** | {{this.type}} |
| **Definition of Done** | {{this.definition_of_done}} |
{{#if this.summary}}
| **Summary** | {{this.summary}} |
{{/if}}

---

### Product History

{{#if this.versions.length}}

Previously, this product went through the following evolution:

{{#each this.versions}}

{{#if (collabsBeforeVersion this)}}
#### Team Discussion (before V{{this.version_number}})

{{#each (collabsBeforeVersion this)}}
> **{{this.author_name}}** said:
> "{{this.content}}"
> *(importance: {{this.importance}})*

{{/each}}
{{/if}}

#### Version {{this.version_number}}

{{#if (eq this.author_id ../currentMember.id)}}
**You** created this version.
{{else}}
**{{this.author_name}}** created this version.
{{/if}}

{{#if this.reflection_notes}}
*Reflection before writing:* {{this.reflection_notes}}
{{/if}}

{{#if this.directive}}
*Chair directive:* {{this.directive}}
{{/if}}

{{#if this.change_summary}}
*Stated change:* {{this.change_summary}}
{{/if}}

{{#if (eq this.id ../selected_version_id)}}
✅ **This version was selected by the Chair.**
{{/if}}

{{/each}}

{{else}}
This is a new product with no prior versions.
{{/if}}

---

### Latest Version Content

{{#if this.latestVersion}}
```
{{this.latestVersion.content}}
```
{{else}}
(No content yet — you're creating V1)
{{/if}}

---

### Feedback Received on Latest Version

{{#if this.latestCollabs.length}}
{{#each this.latestCollabs}}
> **{{this.author_name}}** said:
> "{{this.content}}"
> *(importance: {{this.importance}})*

{{/each}}
{{else}}
(No feedback yet)
{{/if}}

---

### Your Reflection

{{#if this.yourReflection}}
You thought about the feedback and expressed:
> {{this.yourReflection}}
{{else}}
(No reflection recorded)
{{/if}}

---

### Chair Directive for V{{this.nextVersionNumber}}

{{#if this.nextDirective}}
{{this.nextDirective}}
{{else}}
(No specific directive — use your judgment based on DoD and feedback)
{{/if}}

{{/each}}

---

### Instructions

For each product above, write the next version.

Requirements:
1. Satisfy every criterion in the Definition of Done
2. Address all feedback received
3. Consider your reflection and the Chair's directive
4. Structure your content with clear headers and sections
5. Flag any blockers or missing info in remarks

---

## Filled Example

### Your Identity

You are **Alex** (alpha) — **tech-lead**.

#### Your Persona
You are the architect of MenuMaster's technical backbone. Your obsession is real-time data sync that doesn't break. You treat every millisecond of latency as a personal insult.

---

### Mission Context

**Charter:** Build MenuMaster, a SaaS platform for restaurants to manage dynamic menus with real-time inventory sync.

**Underlying Objectives:**
1. Reduce menu update time to 30 seconds
2. Achieve 90% uptime for inventory sync
3. Acquire 100 paying customers in 6 months

---

### Team Context

- **Jordan** (product-manager): UX, user flows, feature prioritization
- **Casey** (growth-marketer): GTM, positioning, customer acquisition

---

### Your Assignment(s)

**Round:** 3

---

## Product: Technical Architecture Spec — Content

| Field | Value |
|-------|-------|
| **ID** | `660e8400-e29b-41d4-a716-446655440001` |
| **Type** | Content |
| **Definition of Done** | System diagram, data flow, API boundaries with rate limiting, auth docs |

---

### Product History

Previously, this product went through the following evolution:

#### Version 1

**You** created this version.

*Chair directive:* Create the technical blueprint that enables <30sec menu updates.

*Stated change:* Initial architecture covering core services and data flow.

---

#### Team Discussion (before V2)

> **Marcus (watchdog)** said:
> "SECURITY: The /public/menus/:id endpoint has no rate limiting. Vulnerable to DDoS."
> *(importance: 8)*

> **Marcus (watchdog)** said:
> "COMPLETENESS: DoD requires auth coverage. Spec mentions Clerk but no validation flow."
> *(importance: 6)*

> **Jordan (product-manager)** said:
> "Could we add a bulk import endpoint? Owners often have menus in spreadsheets."
> *(importance: 5)*

#### Version 2

**You** created this version.

*Reflection before writing:* Need to address rate limiting (critical) and auth gaps. Bulk import is a good idea for onboarding.

*Chair directive:* Address watchdog security concerns. This is blocking acceptance.

*Stated change:* Added rate limiting, auth section, bulk endpoint.

✅ **This version was selected by the Chair.**

---

### Latest Version Content

```
# Technical Architecture Spec V2

## 1. System Overview
MenuMaster is a distributed system with three core services.

## 2. Services
### 2.1 Menu Service
- POST /restaurants/:id/menus
- PUT /menus/:id/items/:itemId
- POST /menus/:id/items/bulk ← NEW
- GET /menus/:id (public)

### 2.4 Authentication & Authorization ← NEW
- JWT validation via Clerk
- Role enforcement for mutations

## 3. API Boundaries
| Endpoint | Auth | Rate Limit |
|----------|------|------------|
| /public/* | None | 100 req/min/IP |
| /menus/* | JWT | 1000 req/min |
```

---

### Feedback Received on Latest Version

> **Jordan (product-manager)** said:
> "How does the owner know inventory sync is working? Need some visibility."
> *(importance: 7)*

> **Jordan (product-manager)** said:
> "What's the UX for QR generation? One-click? Download and print?"
> *(importance: 6)*

---

### Your Reflection

You thought about the feedback and expressed:
> Jordan's sync visibility point is valid—I'll add a sync-status endpoint. The QR UX question is more product than architecture, but I can document the API flow.

---

### Chair Directive for V3

**CORE OBJECTIVE:** Add sync visibility endpoint and document QR generation flow.

**WHY IT MATTERS:** Product team needs these details to design the owner dashboard.

---

### Instructions

For each product above, write the next version.

Requirements:
1. Satisfy every criterion in the Definition of Done
2. Address all feedback received
3. Consider your reflection and the Chair's directive
4. Structure your content with clear headers and sections
5. Flag any blockers or missing info in remarks
